
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // A store owner can read and write their own store document
    // and manage products within their store's subcollection.
    match /stores/{storeId} {
      allow read, write: if request.auth != null && request.auth.token.email == storeId;

      // This rule allows a store owner to manage products in their own store.
      match /products/{productId} {
        allow read, create, update, delete: if request.auth != null && get(/databases/$(database)/documents/stores/$(request.auth.token.email)).id == storeId;
      }
    }
  }
}
